<div class='stock-card'>
    @if (stockEntry != null) {
        <div class="stock-card-header">
            <div class="stock-header-top">
                <div class="row">
                    <h1>{{ stockEntry.ticker }}</h1>
                    <img src="{{stockEntry.img}}" alt=""/>
                    <h2 [style.color]="stockEntry.returns > 0 ? 'green' : (stockEntry.returns < 0 ? 'red' : 'black')">${{ stockEntry.adj_close[stockEntry.adj_close.length - 1] | number: '1.2-2' }}</h2>
                </div>
                <div class="model-outlook">
                    <h2 [style.color]="getColorFromScore(roundMLInd(stockEntry.ml_ind))">{{ roundMLInd(stockEntry.ml_ind) }}</h2>
                    <span class="tooltip-container">
                        <img src="question.png" alt="Info" class="question-icon" />
                        <span class="tooltip-text">
                          ML Model Bullishness Indicator:
                            <br>
                            Positive indicates a bullish outlook, negative indicates a bearish outlook.
                        </span>
                      </span>
                </div>
            </div>
            <div class="small-row">
                <div class="stock-info">
                    <p class="company">{{stockEntry.company}}</p>
                    @if (stockEntry.returns) {
                        <p [style.color]="stockEntry.returns > 0 ? 'green' : (stockEntry.returns < 0 ? 'red' : 'black')">
                            {{ stockEntry.returns > 0 ? '+' + stockEntry.returns : stockEntry.returns }}%
                        </p>
                    }
                </div>
            </div>
        </div>
        <div class="stock-chart" [ngClass]="{
            'full-height': rsiChartData.datasets.length === 0 && macdChartData.datasets.length === 0,
            'main-chart': rsiChartData.datasets.length > 0 || macdChartData.datasets.length > 0
          }">
            <!-- stock-card.component.html -->
            <div *ngIf="loadingChart">Loading chart...</div>
            <canvas baseChart
                    [data]="mainChartData"
                    [options]="mainChartOptions"
                    [type]="'line'"
                    *ngIf="!loadingChart">
            </canvas>

        </div>
        @if(rsiChartData.datasets.length > 0) {
            <div class="stock-chart small">
                <!-- stock-card.component.html -->
                <div *ngIf="loadingChart">Loading chart...</div>
                <canvas baseChart
                        [data]="rsiChartData"
                        [options]="rsiChartOptions"
                        [type]="'line'"
                        *ngIf="!loadingChart">
                </canvas>

            </div>
        }
        @if(macdChartData.datasets.length > 0) {
            <div class="stock-chart small">
                <!-- stock-card.component.html -->
                <div *ngIf="loadingChart">Loading chart...</div>
                <canvas baseChart
                        [data]="macdChartData"
                        [options]="macdChartOptions"
                        [type]="'line'"
                        *ngIf="!loadingChart">
                </canvas>

            </div>
        }
        <div class="custom-legend">
            <div *ngFor="let item of legendItems" class="legend-item">
              <span class="legend-color-box" [style.backgroundColor]="item.color"></span>
              <span class="legend-label">{{ item.label }}</span>
            </div>
        </div>
    }
</div>
  